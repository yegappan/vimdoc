<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Vim: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vim
   </div>
   <div id="projectbrief">Vim Editor Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://github.com/vim/vim/blob/master/runtime/vimlogo.gif"  alt="Vim Logo"/>
</div>
<h1><a class="el" href="namespace_vim.html">Vim</a> source code</h1>
<p>Here are a few hints for finding your way around the source code. This doesn't make it less complex than it is, but it gets you started.</p>
<p>You might also want to read <a href="http://vimdoc.sourceforge.net/htmldoc/develop.html#development"><code>:help development</code></a>.</p>
<h2>Jumping around</h2>
<p>First of all, use <code>:make tags</code> to generate a tags file, so that you can jump around in the source code.</p>
<p>To jump to a function or variable definition, move the cursor on the name and use the <code>CTRL-]</code> command. Use <code>CTRL-T</code> or <code>CTRL-O</code> to jump back.</p>
<p>To jump to a file, move the cursor on its name and use the <code>gf</code> command.</p>
<p>Most code can be found in a file with an obvious name (incomplete list):</p>
<table class="doxtable">
<tr>
<th>File name </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="arglist_8c.html">arglist.c</a> </td><td>handling argument list </td></tr>
<tr>
<td><a class="el" href="autocmd_8c.html">autocmd.c</a> </td><td>autocommands </td></tr>
<tr>
<td><a class="el" href="blob_8c.html">blob.c</a> </td><td>blob data type </td></tr>
<tr>
<td><a class="el" href="buffer_8c.html">buffer.c</a> </td><td>manipulating buffers (loaded files) </td></tr>
<tr>
<td><a class="el" href="bufwrite_8c.html">bufwrite.c</a> </td><td>writing a buffer to file </td></tr>
<tr>
<td><a class="el" href="change_8c.html">change.c</a> </td><td>handling changes to text </td></tr>
<tr>
<td><a class="el" href="cmdexpand_8c.html">cmdexpand.c</a> </td><td>command-line completion </td></tr>
<tr>
<td><a class="el" href="cmdhist_8c.html">cmdhist.c</a> </td><td>command-line history </td></tr>
<tr>
<td><a class="el" href="debugger_8c.html">debugger.c</a> </td><td>vim script debugger </td></tr>
<tr>
<td><a class="el" href="diff_8c.html">diff.c</a> </td><td>diff mode (vimdiff) </td></tr>
<tr>
<td><a class="el" href="drawline_8c.html">drawline.c</a> </td><td>drawing a window line </td></tr>
<tr>
<td><a class="el" href="drawscreen_8c.html">drawscreen.c</a> </td><td>drawing the windows </td></tr>
<tr>
<td><a class="el" href="eval_8c.html">eval.c</a> </td><td>expression evaluation </td></tr>
<tr>
<td><a class="el" href="evalbuffer_8c.html">evalbuffer.c</a> </td><td>buffer related built-in functions </td></tr>
<tr>
<td><a class="el" href="evalfunc_8c.html">evalfunc.c</a> </td><td>built-in functions </td></tr>
<tr>
<td><a class="el" href="evalvars_8c.html">evalvars.c</a> </td><td>vim variables </td></tr>
<tr>
<td><a class="el" href="evalwindow_8c.html">evalwindow.c</a> </td><td>window related built-in functions </td></tr>
<tr>
<td><a class="el" href="fileio_8c.html">fileio.c</a> </td><td>reading and writing files </td></tr>
<tr>
<td><a class="el" href="filepath_8c.html">filepath.c</a> </td><td>dealing with file names and paths </td></tr>
<tr>
<td><a class="el" href="findfile_8c.html">findfile.c</a> </td><td>search for files in 'path' </td></tr>
<tr>
<td><a class="el" href="fold_8c.html">fold.c</a> </td><td>folding </td></tr>
<tr>
<td><a class="el" href="getchar_8c.html">getchar.c</a> </td><td>getting characters and key mapping </td></tr>
<tr>
<td><a class="el" href="highlight_8c.html">highlight.c</a> </td><td>syntax highlighting </td></tr>
<tr>
<td><a class="el" href="indent_8c.html">indent.c</a> </td><td>C and Lisp indentation </td></tr>
<tr>
<td><a class="el" href="insexpand_8c.html">insexpand.c</a> </td><td>Insert mode completion </td></tr>
<tr>
<td><a class="el" href="mark_8c.html">mark.c</a> </td><td>marks </td></tr>
<tr>
<td><a class="el" href="map_8c.html">map.c</a> </td><td>mapping and abbreviations </td></tr>
<tr>
<td><a class="el" href="mbyte_8c.html">mbyte.c</a> </td><td>multi-byte character handling </td></tr>
<tr>
<td><a class="el" href="memfile_8c.html">memfile.c</a> </td><td>storing lines for buffers in a swapfile </td></tr>
<tr>
<td><a class="el" href="memline_8c.html">memline.c</a> </td><td>storing lines for buffers in memory </td></tr>
<tr>
<td><a class="el" href="menu_8c.html">menu.c</a> </td><td>menus </td></tr>
<tr>
<td><a class="el" href="message_8c.html">message.c</a> </td><td>(error) messages </td></tr>
<tr>
<td><a class="el" href="mouse_8c.html">mouse.c</a> </td><td>handling the mouse </td></tr>
<tr>
<td><a class="el" href="ops_8c.html">ops.c</a> </td><td>handling operators ("d", "y", "p") </td></tr>
<tr>
<td><a class="el" href="option_8c.html">option.c</a> </td><td>options </td></tr>
<tr>
<td><a class="el" href="optionstr_8c.html">optionstr.c</a> </td><td>handling string options </td></tr>
<tr>
<td><a class="el" href="popupmenu_8c.html">popupmenu.c</a> </td><td>popup menu </td></tr>
<tr>
<td><a class="el" href="popupwin_8c.html">popupwin.c</a> </td><td>popup window </td></tr>
<tr>
<td><a class="el" href="profiler_8c.html">profiler.c</a> </td><td>vim script profiler </td></tr>
<tr>
<td><a class="el" href="quickfix_8c.html">quickfix.c</a> </td><td>quickfix commands (":make", ":cn") </td></tr>
<tr>
<td><a class="el" href="regexp_8c.html">regexp.c</a> </td><td>pattern matching </td></tr>
<tr>
<td><a class="el" href="register_8c.html">register.c</a> </td><td>handling registers </td></tr>
<tr>
<td><a class="el" href="scriptfile_8c.html">scriptfile.c</a> </td><td>runtime directory handling and sourcing scripts </td></tr>
<tr>
<td><a class="el" href="screen_8c.html">screen.c</a> </td><td>lower level screen functions </td></tr>
<tr>
<td><a class="el" href="search_8c.html">search.c</a> </td><td>pattern searching </td></tr>
<tr>
<td><a class="el" href="session_8c.html">session.c</a> </td><td>sessions and views </td></tr>
<tr>
<td><a class="el" href="sign_8c.html">sign.c</a> </td><td>signs </td></tr>
<tr>
<td><a class="el" href="spell_8c.html">spell.c</a> </td><td>spell checking core </td></tr>
<tr>
<td><a class="el" href="spellfile_8c.html">spellfile.c</a> </td><td>spell file handling </td></tr>
<tr>
<td><a class="el" href="spellsuggest_8c.html">spellsuggest.c</a> </td><td>spell correction suggestions </td></tr>
<tr>
<td><a class="el" href="syntax_8c.html">syntax.c</a> </td><td>syntax and other highlighting </td></tr>
<tr>
<td><a class="el" href="tag_8c.html">tag.c</a> </td><td>tags </td></tr>
<tr>
<td><a class="el" href="term_8c.html">term.c</a> </td><td>terminal handling, termcap codes </td></tr>
<tr>
<td><a class="el" href="testing_8c.html">testing.c</a> </td><td>testing: assert and test functions </td></tr>
<tr>
<td><a class="el" href="textprop_8c.html">textprop.c</a> </td><td>text properties </td></tr>
<tr>
<td><a class="el" href="undo_8c.html">undo.c</a> </td><td>undo and redo </td></tr>
<tr>
<td><a class="el" href="usercmd_8c.html">usercmd.c</a> </td><td>user defined commands </td></tr>
<tr>
<td><a class="el" href="userfunc_8c.html">userfunc.c</a> </td><td>user defined functions </td></tr>
<tr>
<td><a class="el" href="viminfo_8c.html">viminfo.c</a> </td><td>viminfo handling </td></tr>
<tr>
<td><a class="el" href="window_8c.html">window.c</a> </td><td>handling split windows </td></tr>
</table>
<h2>Debugging</h2>
<p>If you have a reasonable recent version of gdb, you can use the <code>:Termdebug</code> command to debug <a class="el" href="namespace_vim.html">Vim</a>. See <code>:help :Termdebug</code>.</p>
<p>When something is time critical or stepping through code is a hassle, use the channel logging to create a time-stamped log file. Add lines to the code like this: </p><pre class="fragment">ch_log(NULL, "Value is now %02x", value);
</pre><p>After compiling and starting <a class="el" href="namespace_vim.html">Vim</a>, do: </p><pre class="fragment">:call ch_logfile('debuglog', 'w')
</pre><p>And edit <code>debuglog</code> to see what happens. The channel functions already have <code>ch_log()</code> calls, thus you always see that in the log.</p>
<h2>Important Variables</h2>
<p>The current mode is stored in <code>State</code>. The values it can have are <code>NORMAL</code>, <code>INSERT</code>, <code>CMDLINE</code>, and a few others.</p>
<p>The current window is <code>curwin</code>. The current buffer is <code>curbuf</code>. These point to structures with the cursor position in the window, option values, the file name, etc. These are defined in <a href="https://github.com/vim/vim/blob/master/src/structs.h"><code>structs.h</code></a>.</p>
<p>All the global variables are declared in <a href="https://github.com/vim/vim/blob/master/src/globals.h"><code>globals.h</code></a>.</p>
<h2>The main loop</h2>
<p>This is conveniently called <code><a class="el" href="main_8c.html#acb339d29f1748013074d16159e34c1d5">main_loop()</a></code>. It updates a few things and then calls <code><a class="el" href="normal_8c.html#abccf91837ccc71338198f4f42795c11b">normal_cmd()</a></code> to process a command. This returns when the command is finished.</p>
<p>The basic idea is that <a class="el" href="namespace_vim.html">Vim</a> waits for the user to type a character and processes it until another character is needed. Thus there are several places where <a class="el" href="namespace_vim.html">Vim</a> waits for a character to be typed. The <code><a class="el" href="getchar_8c.html#a15db3f8639823b11e0a9e1ea99873be5">vgetc()</a></code> function is used for this. It also handles mapping.</p>
<p>Updating the screen is mostly postponed until a command or a sequence of commands has finished. The work is done by <code><a class="el" href="drawscreen_8c.html#a81c096fb8da4688bbc2ba5fd8275e0bb">update_screen()</a></code>, which calls <code><a class="el" href="drawscreen_8c.html#a18273510de65d4baa1d652a618795587">win_update()</a></code> for every window, which calls <code><a class="el" href="drawline_8c.html#a62d47609529a54beb245a2d3765151a3">win_line()</a></code> for every line. See the start of <a href="https://github.com/vim/vim/blob/master/src/screen.c"><code>screen.c</code></a> for more explanations.</p>
<h2>Command-line mode</h2>
<p>When typing a <code>:</code>, <code><a class="el" href="normal_8c.html#abccf91837ccc71338198f4f42795c11b">normal_cmd()</a></code> will call <code><a class="el" href="ex__getln_8c.html#afb8e24866dc9d1aa9140007413a6c189">getcmdline()</a></code> to obtain a line with an Ex command. <code><a class="el" href="ex__getln_8c.html#afb8e24866dc9d1aa9140007413a6c189">getcmdline()</a></code> contains a loop that will handle each typed character. It returns when hitting <code>CR</code> or <code>Esc</code> or some other character that ends the command line mode.</p>
<h2>Ex commands</h2>
<p>Ex commands are handled by the function <code><a class="el" href="ex__docmd_8c.html#ac2ef63cea42252cb8371e8c1faba1605">do_cmdline()</a></code>. It does the generic parsing of the <code>:</code> command line and calls <code><a class="el" href="ex__docmd_8c.html#a566c510df4c69150604db808942d9f78">do_one_cmd()</a></code> for each separate command. It also takes care of while loops.</p>
<p><code><a class="el" href="ex__docmd_8c.html#a566c510df4c69150604db808942d9f78">do_one_cmd()</a></code> parses the range and generic arguments and puts them in the <code>exarg_t</code> and passes it to the function that handles the command.</p>
<p>The <code>:</code> commands are listed in <code><a class="el" href="ex__cmds_8h.html">ex_cmds.h</a></code>. The third entry of each item is the name of the function that handles the command. The last entry are the flags that are used for the command.</p>
<h2>Normal mode commands</h2>
<p>The Normal mode commands are handled by the <code><a class="el" href="normal_8c.html#abccf91837ccc71338198f4f42795c11b">normal_cmd()</a></code> function. It also handles the optional count and an extra character for some commands. These are passed in a <code>cmdarg_t</code> to the function that handles the command.</p>
<p>There is a table <code>nv_cmds</code> in <a href="https://github.com/vim/vim/blob/master/src/normal.c"><code>normal.c</code></a> which lists the first character of every command. The second entry of each item is the name of the function that handles the command.</p>
<h2>Insert mode commands</h2>
<p>When doing an <code>i</code> or <code>a</code> command, <code><a class="el" href="normal_8c.html#abccf91837ccc71338198f4f42795c11b">normal_cmd()</a></code> will call the <code><a class="el" href="edit_8c.html#af1d3349b9c831286998667e1feefb539">edit()</a></code> function. It contains a loop that waits for the next character and handles it. It returns when leaving Insert mode.</p>
<h2>Options</h2>
<p>There is a list with all option names in <a href="https://github.com/vim/vim/blob/master/src/option.c"><code>option.c</code></a>, called <code>options[]</code>.</p>
<h2>The GUI</h2>
<p>Most of the GUI code is implemented like it was a clever terminal. Typing a character, moving a scrollbar, clicking the mouse, etc. are all translated into events which are written in the input buffer. These are read by the main code, just like reading from a terminal. The code for this is scattered through <a href="https://github.com/vim/vim/blob/master/src/gui.c"><code>gui.c</code></a>. For example, <code><a class="el" href="gui_8c.html#ab234c37f0f92df7ecc62be09ab863b64">gui_send_mouse_event()</a></code> for a mouse click and <code><a class="el" href="gui_8c.html#adc9d4fd22c474f9ad2d437a37e34d447">gui_menu_cb()</a></code> for a menu action. Key hits are handled by the system-specific GUI code, which calls <code>add_to_input_buf()</code> to send the key code.</p>
<p>Updating the GUI window is done by writing codes in the output buffer, just like writing to a terminal. When the buffer gets full or is flushed, <code><a class="el" href="gui_8c.html#aa704280bb1af453d7a5e7f6de53f4fda">gui_write()</a></code> will parse the codes and draw the appropriate items. Finally the system-specific GUI code will be called to do the work.</p>
<h2>Debugging the GUI</h2>
<p>Remember to prevent that gvim forks and the debugger thinks <a class="el" href="namespace_vim.html">Vim</a> has exited, add the <code>-f</code> argument. In gdb: <code>run -f -g</code>.</p>
<p>When stepping through display updating code, the focus event is triggered when going from the debugger to <a class="el" href="namespace_vim.html">Vim</a> and back. To avoid this, recompile with some code in <code><a class="el" href="gui_8c.html#aa0515a5a0e479559bad8cc7b5ad0b019">gui_focus_change()</a></code> disabled.</p>
<h2>Contributing</h2>
<p>If you would like to help making <a class="el" href="namespace_vim.html">Vim</a> better, see the https://github.com/vim/vim/blob/master/CONTRIBUTING.md "`CONTRIBUTING.md`" file.</p>
<p>This is <code><a class="el" href="_r_e_a_d_m_e_8md.html">README.md</a></code> for version 8.1 of the <a class="el" href="namespace_vim.html">Vim</a> source code. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
